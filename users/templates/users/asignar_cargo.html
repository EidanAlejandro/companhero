<!-- users/templates/users/asignar_cargo.html -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Asignar Cargos</title>
</head>
<body>
    <h1>Asignar Cargos</h1>
    
    {% if messages %}
        {% for message in messages %}
            {% if message.tags == 'error' %}
            <div style="color: red; margin: 10px 0; padding: 10px; border: 1px solid red;">
                {{ message }}
            </div>
            {% else %}
            <div style="color: green; margin: 10px 0; padding: 10px; border: 1px solid green;">
                {{ message }}
            </div>
            {% endif %}
        {% endfor %}
    {% endif %}
    
    <form method="post">
        {% csrf_token %}
        
        <div>
            <label>Usuarios:</label>
            <select name="usuario" id="usuarioSelect" required>
                <option value="">Seleccione un usuario</option>
                {% for usuario in usuarios %}
                <option value="{{ usuario.id_usuario }}">
                    {{ usuario.nombre }} {{ usuario.apellido }}
                </option>
                {% endfor %}
            </select>
        </div>
        
        <!-- Menú de Direcciones (solo para Encargado de Dirección) -->
        <div id="direccionField" style="display: none; margin-top: 15px;">
            <label>Direcciones:</label>
            <select name="direccion" id="direccionSelect">
                <option value="">Seleccione una dirección</option>
                {% for direccion in direcciones %}
                <option value="{{ direccion.id_direccion }}">
                    {{ direccion.nombre_direccion }}
                </option>
                {% endfor %}
            </select>
        </div>
        
        <!-- Menú de Departamentos (solo para Encargado de Departamento) -->
        <div id="departamentoField" style="display: none; margin-top: 15px;">
            <label>Departamentos:</label>
            <select name="departamento" id="departamentoSelect">
                <option value="">Seleccione un departamento</option>
                {% for departamento in departamentos %}
                <option value="{{ departamento.id_departamento }}">
                    {{ departamento.nombre_departamento }}
                </option>
                {% endfor %}
            </select>
        </div>
        
        <div style="margin-top: 15px;">
            <label>Cargos:</label>
            <select name="cargo" id="cargoSelect" required onchange="toggleCampos()">
                <option value="">Seleccione un cargo</option>
                <option value="encargado_direccion">Encargado de Dirección</option>
                <option value="encargado_departamento">Encargado de Departamento</option>
                <option value="territorial">Territorial</option>
                <option value="jefe_cuadrilla">Jefe de Cuadrilla</option>
            </select>
        </div>
        
        <!-- Botón Guardar Asignación -->
        <div id="botonGuardar" style="display: none; margin-top: 20px;">
            <button type="submit">Guardar Asignación</button>
        </div>
    </form>
    
    <br>
    <a href="{% url 'listar_usuarios' %}">
        <button>Volver</button>
    </a>

    <script>
        function toggleCampos() {
            const cargoSelect = document.getElementById('cargoSelect');
            const direccionField = document.getElementById('direccionField');
            const departamentoField = document.getElementById('departamentoField');
            const botonGuardar = document.getElementById('botonGuardar');
            const usuarioSelect = document.getElementById('usuarioSelect');
            
            // Ocultar todos los campos primero
            direccionField.style.display = 'none';
            departamentoField.style.display = 'none';
            botonGuardar.style.display = 'none';
            
            // Mostrar campos según el cargo seleccionado
            if (cargoSelect.value === 'encargado_direccion') {
                direccionField.style.display = 'block';
                // Mostrar botón si hay usuario seleccionado
                if (usuarioSelect.value !== '') {
                    botonGuardar.style.display = 'block';
                }
            } else if (cargoSelect.value === 'encargado_departamento') {
                departamentoField.style.display = 'block';
                // Mostrar botón si hay usuario seleccionado
                if (usuarioSelect.value !== '') {
                    botonGuardar.style.display = 'block';
                }
            }
        }
        
        // También verificar cuando cambia el usuario
        document.getElementById('usuarioSelect').addEventListener('change', function() {
            const cargoSelect = document.getElementById('cargoSelect');
            const botonGuardar = document.getElementById('botonGuardar');
            
            // Mostrar botón si hay cargo y usuario seleccionados
            if ((cargoSelect.value === 'encargado_direccion' || cargoSelect.value === 'encargado_departamento') && 
                this.value !== '') {
                botonGuardar.style.display = 'block';
            } else {
                botonGuardar.style.display = 'none';
            }
        });
    </script>
</body>
</html>